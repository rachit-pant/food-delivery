generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model carts {
  id            Int            @id @default(autoincrement())
  user_id       Int
  menu_id       Int
  variant_id    Int?
  quantity      Int
  restaurant_id Int
  menus         menus          @relation(fields: [menu_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  restaurants   restaurants    @relation("RestaurantCarts", fields: [restaurant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users         users          @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  menu_variants menu_variants? @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, menu_id, variant_id])
}

model cities {
  id              Int               @id @default(autoincrement())
  state_id        Int?
  city_name       String            @db.VarChar
  states          states?           @relation(fields: [state_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_addresses order_addresses[]
  restaurants     restaurants[]
  user_addresses  user_addresses[]
}

model countries {
  id           Int      @id @default(autoincrement())
  country_name String   @db.VarChar
  states       states[]
}

model menu_categories {
  id       Int     @id @default(autoincrement())
  cat_name String  @db.VarChar
  menus    menus[]
}

model menu_variants {
  id           Int           @id @default(autoincrement())
  menu_id      Int?
  variety_name String        @db.VarChar
  price        Float
  carts        carts[]
  menus        menus?        @relation(fields: [menu_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  order_items  order_items[]
}

model menus {
  id              Int              @id @default(autoincrement())
  restaurant_id   Int?
  category_id     Int?
  item_name       String           @db.VarChar
  description     String?
  image_url       String?
  price           Float
  carts           carts[]
  menu_variants   menu_variants[]
  menu_categories menu_categories? @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  restaurants     restaurants?     @relation(fields: [restaurant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  order_items     order_items[]
}

model order_addresses {
  id             Int             @id @default(autoincrement())
  address_id     Int?
  order_id       Int?            @unique
  address        String?
  city_id        Int?
  user_addresses user_addresses? @relation(fields: [address_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cities         cities?         @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders         orders?         @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model order_items {
  id            Int            @id @default(autoincrement())
  order_id      Int?
  menu_id       Int?
  variant_id    Int?
  price         Float?
  quantity      Int?
  total_amount  Float?
  product_name  String?        @db.VarChar
  menus         menus?         @relation(fields: [menu_id], references: [id], onUpdate: NoAction)
  orders        orders?        @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  menu_variants menu_variants? @relation(fields: [variant_id], references: [id], onUpdate: NoAction)
}

model order_payments {
  id             Int             @id @default(autoincrement())
  order_id       Int?
  amount         Float?
  payment_mode   payment_mode?
  payment_status payment_status?
  orders         orders?         @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id               Int              @id @default(autoincrement())
  user_id          Int?
  restaurant_id    Int?
  total_amount     Float?
  discount_amount  Float?
  delivery_charges Float?
  tax_amount       Float?
  net_amount       Float?
  payment_status   payment_status?
  status           order_status?    @default(placed)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  order_addresses  order_addresses?
  order_items      order_items[]
  order_payments   order_payments[]
  restaurants      restaurants?     @relation(fields: [restaurant_id], references: [id], onUpdate: NoAction)
  users            users?           @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews          reviews[]
}

model restaurant_timings {
  id            Int         @id @default(autoincrement())
  restaurant_id Int
  week_day      String      @db.VarChar
  start_time    DateTime?   @db.Time(6)
  end_time      DateTime?   @db.Time(6)
  restaurants   restaurants @relation(fields: [restaurant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model restaurants {
  id                       Int                      @id @default(autoincrement())
  user_id                  Int?
  name                     String                   @db.VarChar
  address                  String?
  city_id                  Int?
  rating                   Float?
  status                   restaurant_status?       @default(inactive)
  imageurl                 String?
  search_vector            Unsupported("tsvector")?
  franchiseId              Int?
  restaurant_categories_id Int                      @default(1)
  carts                    carts[]                  @relation("RestaurantCarts")
  menus                    menus[]
  orders                   orders[]
  restaurant_timings       restaurant_timings[]
  cities                   cities?                  @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  franchise                Franchise?               @relation(fields: [franchiseId], references: [id])
  restaurant_categories    restaurant_categories    @relation(fields: [restaurant_categories_id], references: [id])
  users                    users?                   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews                  reviews[]

  @@index([search_vector], map: "restaurants_search_gin", type: Gin)
}

model states {
  id         Int        @id @default(autoincrement())
  country_id Int?
  state_name String     @db.VarChar
  cities     cities[]
  countries  countries? @relation(fields: [country_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_addresses {
  id              Int               @id @default(autoincrement())
  user_id         Int?
  address         String?
  city_id         Int?
  is_default      Boolean           @default(false)
  order_addresses order_addresses[]
  cities          cities?           @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users           users?            @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_devices {
  id          Int          @id @default(autoincrement())
  user_id     Int?
  device_type device_type?
  os_type     String?
  users       users?       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model reviews {
  id            Int         @id @default(autoincrement())
  user_id       Int
  order_id      Int
  review        String?
  rating        Int
  restaurant_id Int
  order         orders      @relation(fields: [order_id], references: [id])
  restaurant    restaurants @relation(fields: [restaurant_id], references: [id])
  user          users       @relation(fields: [user_id], references: [id])
}

model user_roles {
  id        Int     @id @default(autoincrement())
  role_name String  @unique
  plans     Plan[]
  users     users[]
}

model users {
  id             Int              @id @default(autoincrement())
  role_id        Int?
  full_name      String?          @db.VarChar
  email          String?          @unique @db.VarChar
  phone_number   String?          @unique @db.VarChar
  password       String           @default("changeme123")
  refreshToken   String?
  Franchise      Franchise[]
  subs           Sub[]
  carts          carts[]
  orders         orders[]
  restaurants    restaurants[]
  reviews        reviews[]
  staff          staff[]
  user_addresses user_addresses[]
  user_devices   user_devices[]
  user_roles     user_roles?      @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Plan {
  id              Int          @id @default(autoincrement())
  name            String
  price           Decimal      @db.Decimal(10, 2)
  role_id         Int
  duration        PlanDuration
  features        Json
  stripe_price_id String?      @unique
  role            user_roles   @relation(fields: [role_id], references: [id])
  subs            Sub[]
}

model Sub {
  id                     Int                @id @default(autoincrement())
  user_id                Int
  plan_id                Int
  status                 SubscriptionStatus @default(active)
  startDate              DateTime
  endDate                DateTime
  isDefault              Boolean            @default(false)
  price                  Decimal            @db.Decimal(10, 2)
  createdAt              DateTime           @default(now()) @db.Timestamptz(3)
  updatedAt              DateTime           @updatedAt @db.Timestamptz(3)
  paymentStatus          payment_response
  stripe_subscription_id String?            @unique
  plan                   Plan               @relation(fields: [plan_id], references: [id])
  user                   users              @relation(fields: [user_id], references: [id])
}

model Franchise {
  id              Int              @id @default(autoincrement())
  userId          Int
  name            String?
  address         String?
  image_url       String?
  status          FranchiseStatus  @default(ACTIVE)
  createdAt       DateTime         @default(now()) @db.Timestamptz(3)
  updatedAt       DateTime         @updatedAt @db.Timestamptz(3)
  owner           users            @relation(fields: [userId], references: [id])
  franchise_staff FranchiseStaff[]
  restaurants     restaurants[]
  franchise         StaffInvite[]
}

model staff {
  id          Int              @id @default(autoincrement())
  userId      Int
  fullName    String?
  staffRoleId Int
  status      StaffStatus      @default(ACTIVE)
  createdAt   DateTime         @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime         @updatedAt @db.Timestamptz(3)
  franchises  FranchiseStaff[]
  role        StaffRole        @relation(fields: [staffRoleId], references: [id])
  user        users            @relation(fields: [userId], references: [id])
}

model StaffRole {
  id          Int      @id @default(autoincrement())
  role        String
  description String?
  createdAt   DateTime @default(now()) @db.Timestamptz(3)
  staff       staff[]
  invites     StaffInvite[]
}

model FranchiseStaff {
  id          Int       @id @default(autoincrement())
  staffId     Int
  franchiseId Int
  position    String?
  isActive    Boolean   @default(true)
  assignedAt  DateTime  @default(now()) @db.Timestamptz(3)
  endedAt     DateTime? @db.Timestamptz(3)
  franchise   Franchise @relation(fields: [franchiseId], references: [id])
  staff       staff     @relation(fields: [staffId], references: [id])
}
model StaffInvite {
  id          Int      @id @default(autoincrement())
  email       String
  franchiseId Int
  roleId      Int
  token       String   @unique
  status      StaffInviteStatus @default(PENDING)
  createdAt   DateTime @default(now()) @db.Timestamptz(3)
  expiresAt   DateTime @db.Timestamptz(3)
  acceptedAt  DateTime? @db.Timestamptz(3)

  franchise   Franchise @relation(fields: [franchiseId], references: [id])
  staffRole   StaffRole @relation(fields: [roleId], references: [id])
}
model restaurant_categories {
  id          Int           @id @default(autoincrement())
  cat_name    String        @db.VarChar
  restaurants restaurants[]
}
enum StaffInviteStatus {
  PENDING
  ACCEPTED
  EXPIRED
}
enum FranchiseStatus {
  ACTIVE
  INACTIVE
}

enum StaffStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum SubscriptionStatus {
  active
  expired
  canceled
}

enum PlanDuration {
  month
  year
}

enum device_type {
  phone
  desktop
}

enum order_status {
  placed
  accepted
  preparing
  prepared
  picked
  delivered
  cancelled
}

enum payment_mode {
  net_banking       @map("net banking")
  UPI
  COD
  Debit_Credit_Card @map("Debit/Credit Card")
}

enum payment_response {
  draft
  open
  paid
  uncollectible
  void
}

enum payment_status {
  paid
  not_paid @map("not paid")
  success
  failed
}

enum restaurant_status {
  active
  inactive
}

enum roles {
  merchant
  customer
  admin
}
