generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model carts {
  id            Int            @id @default(autoincrement())
  user_id       Int
  menu_id       Int
  variant_id    Int?
  restaurant_id Int
  quantity      Int
  menus         menus?         @relation(fields: [menu_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users?         @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  menu_variants menu_variants? @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  restaurants   restaurants?   @relation("RestaurantCarts", fields: [restaurant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, menu_id, variant_id])
}


model cities {
  id              Int               @id @default(autoincrement())
  state_id        Int?
  city_name       String            @db.VarChar
  states          states?           @relation(fields: [state_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_addresses order_addresses[]
  restaurants     restaurants[]
  user_addresses  user_addresses[]
}

model countries {
  id           Int    @id @default(autoincrement())
  country_name String @db.VarChar

  states states[]
}

model menu_categories {
  id       Int     @id @default(autoincrement())
  cat_name String  @db.VarChar
  menus    menus[]
}

model menu_variants {
  id           Int           @id @default(autoincrement())
  menu_id      Int?
  variety_name String        @db.VarChar
  price        Float
  carts        carts[]
  menus        menus?        @relation(fields: [menu_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  order_items  order_items[]
}

model menus {
  id              Int              @id @default(autoincrement())
  restaurant_id   Int?
  category_id     Int?
  item_name       String           @db.VarChar
  description     String?
  image_url       String?
  price           Float
  carts           carts[]
  menu_variants   menu_variants[]
  menu_categories menu_categories? @relation(fields: [category_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  restaurants     restaurants?     @relation(fields: [restaurant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  order_items     order_items[]
}

model order_addresses {
  id             Int             @id @default(autoincrement())
  address_id     Int?
  order_id       Int? @unique
  address        String?
  city_id        Int?
  user_addresses user_addresses? @relation(fields: [address_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  cities         cities?         @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  orders         orders?         @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model order_items {
  id            Int            @id @default(autoincrement())
  order_id      Int?
  menu_id       Int?
  variant_id    Int?
  price         Float?
  quantity      Int?
  total_amount  Float?
  product_name  String?        @db.VarChar
  menus         menus?         @relation(fields: [menu_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
  orders        orders?        @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  menu_variants menu_variants? @relation(fields: [variant_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
}

model order_payments {
  id             Int             @id @default(autoincrement())
  order_id       Int?
  amount         Float?
  payment_mode   payment_mode?
  payment_status payment_status?
  orders         orders?         @relation(fields: [order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id               Int               @id @default(autoincrement())
  user_id          Int?
  restaurant_id    Int?
  total_amount     Float?
  discount_amount  Float?
  delivery_charges Float?
  tax_amount       Float?
  net_amount       Float?
  payment_status   payment_status?
  status           order_status?     @default(placed)
  createdAt        DateTime          @default(now())       
  updatedAt        DateTime          @updatedAt           
  order_addresses  order_addresses?
  order_items      order_items[]
  order_payments   order_payments[]
  restaurants      restaurants?      @relation(fields: [restaurant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users            users?            @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews reviews[]
}

model restaurant_timings {
  id            Int          @id @default(autoincrement())
  restaurant_id Int
  week_day      String       @db.VarChar
  start_time    DateTime?    @db.Time(6)
  end_time      DateTime?    @db.Time(6)
  restaurants   restaurants @relation(fields: [restaurant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model restaurants {
  id                 Int                  @id @default(autoincrement())
  user_id            Int?
  name               String               @db.VarChar
  address            String?
  city_id            Int?
  rating             Float?
  imageurl           String?  
  status             restaurant_status?   @default(inactive)
  menus              menus[]
  orders             orders[]
  restaurant_timings restaurant_timings[]
  cities             cities?              @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users              users?               @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  carts   carts[]   @relation("RestaurantCarts")
  reviews reviews[]

}

model states {
  id         Int        @id @default(autoincrement())
  country_id Int?
  state_name String     @db.VarChar
  cities     cities[]
  countries  countries? @relation(fields: [country_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_addresses {
  id      Int     @id @default(autoincrement())
  user_id Int?
  address String?
  city_id Int?

  order_addresses order_addresses[]

  cities cities? @relation(fields: [city_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users  users?  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_devices {
  id          Int          @id @default(autoincrement())
  user_id     Int?
  device_type device_type?
  os_type     String?
  users       users?       @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
model reviews {
  id        Int     @id @default(autoincrement())
  user_id   Int
  order_id  Int
  restaurant_id Int
  review    String?
  rating    Int      // rating 1â€“5 (or any scale you want)

  // Relations
  user   users  @relation(fields: [user_id], references: [id])
  order  orders @relation(fields: [order_id], references: [id])
  restaurant restaurants  @relation(fields: [restaurant_id], references: [id])
}


model user_roles {
  id        Int     @id @default(autoincrement())
  role_name  String  @unique
  users     users[]
}

model users {
  id             Int              @id @default(autoincrement())
  role_id        Int?
  full_name      String?          @db.VarChar
  email          String?          @unique @db.VarChar
  phone_number   String?          @unique @db.VarChar
  password       String           @default("changeme123")
  refreshToken  String?
  carts          carts[]
  orders         orders[]
  restaurants    restaurants[]
  user_addresses user_addresses[]
  user_devices   user_devices[]
  user_roles     user_roles?      @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews reviews[]
}

enum device_type {
  phone
  desktop
}

enum order_status {
  placed
  accepted
  preparing
  prepared
  picked
  delivered
  cancelled
}

enum payment_mode {
  net_banking       @map("net banking")
  UPI
  COD
  Debit_Credit_Card @map("Debit/Credit Card")
}

enum payment_status {
  paid
  not_paid @map("not paid")
  success
  failed
}

enum restaurant_status {
  active
  inactive
}

enum roles {
  merchant
  customer
  admin
}
